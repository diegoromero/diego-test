<!DOCTYPE html>
<html>
	<head>
		<title>{{ title }}</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		{% load staticfiles %}
		<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
		<!--<script type="text/javascript" src="{% static 'js/jstree.min.js' %}" ></script>-->
		<script type="text/javascript" src="{% static 'js/jquery.jstree.js' %}"></script>
	</head>
	<body>
		<p>Hello</p>
		<div id="jstree-test-old"></div>
		
		<form action="https://diego-test_bucket.s3.amazonaws.com/" method="post" enctype="multipart/form-data" id="up_form">
			<input type="hidden" name="key" value="uploads/${filename}">
			<input type="hidden" name="AWSAccessKeyId" value={{ AWS_ACCESS_KEY_ID }}> 
			<input type="hidden" name="acl" value="public-read"> 
			<input type="hidden" name="success_action_redirect" value="http://diego-test.herokuapp.com/">
			<input type="hidden" name="policy" value={{ policy }}>
			<input type="hidden" name="signature" value={{ signature }}>
			<input type="hidden" name="Content-Type" value="image/jpeg">
			<!-- Include any additional input fields here -->

			File to upload to S3: 
			<input name="file" type="file" id="file"> 
			<br> 
			<input type="button" value="Upload File to S3"> 
		</form> 
		<progress></progress>
	</body>
	<script type="text/javascript">
		$(':button').click(function(){
			var formData = new FormData($('form')[0]);
			$.ajax({
				url: $('form').attr('action'),  //Server script to process data
				type: 'POST',
				xhr: function() {  // Custom XMLHttpRequest
					var myXhr = $.ajaxSettings.xhr();
					if(myXhr.upload){ // Check if upload property exists
						myXhr.upload.addEventListener('progress',progressHandlingFunction, false); // For handling the progress of the upload
					}
					return myXhr;
				},
				//Ajax events
				beforeSend: beforeSendHandler,
				success: completeHandler,
				error: errorHandler,
				// Form data
				data: formData,
				//Options to tell jQuery not to process data or worry about content-type.
				cache: false,
				contentType: false,
				processData: false
			});
		});
		
		function progressHandlingFunction(e){
			if(e.lengthComputable){
				$('progress').attr({value:e.loaded,max:e.total});
			}
		}
	</script>
	
	<script type='text/javascript'>

		var jmenus = {{ json_menus|safe }};
		var menus = new Array();
		var a = 0;
		for (var i=0; i<jmenus.length; i++){
			menus[i] = eval("(" + jmenus[i] + ')');
		};

	</script>
</html>