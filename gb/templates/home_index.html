<!DOCTYPE html>
<html>
	<head>
		<title>{{ title }}</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		{% load staticfiles %}
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
		<!--<script type="text/javascript" src="{% static 'js/jstree.min.js' %}" ></script>-->
		<script type="text/javascript" src="{% static 'js/jquery.jstree.js' %}"></script>
		<script type="text/javascript" src="{% static 'js/jquery.fileupload.js' %}"></script>
		<script type="text/javascript" src="{% static 'js/jquery.iframe-transport.js' %}"></script>
		<link rel="stylesheet" type="text/css" href="{% static 'css/up.css' %}"> 
	</head>
	<body>
		<p>Hello</p>
		</br>
		<p>Method: {{ method }}</p>
		</br>
		<p>file: <span id='upload_original_name'></span></p>
		<div id="jstree-test-old"></div>
		
		<form action="https://diego-test_bucket.s3.amazonaws.com/" method="post" enctype="multipart/form-data" class="direct-upload">
			<input type="hidden" name="key" value="uploads/${filename}">
			<input type="hidden" name="AWSAccessKeyId" value={{ AWS_ACCESS_KEY_ID }}> 
			<input type="hidden" name="acl" value="public-read"> 
			<input type="hidden" name="success_action_redirect" value="http://diego-test.herokuapp.com/">
			<input type="hidden" name="policy" value={{ policy }}>
			<input type="hidden" name="signature" value={{ signature }}>
			<input type="hidden" name="Content-Type" value="image/jpeg">
			<!-- Include any additional input fields here -->

			File to upload to S3: 
			<input name="file" type="file" id="file"> 
			<div class="progress"><div class="bar"></div></div>
			<input type="submit" value="Save" />
		</form> 
		<!-- Used to Track Upload within our App -->
		<form action="" method="POST">
			<input type="hidden" name="upload_original_name" />

			<label for="upload_custom_name">Name:</label><br />
			<input type="text" name="upload_custom_name" id="upload_custom_name" /><br />

			<input type="submit" value="Save" />
		</form>
	</body>
	<script type="text/javascript">
		$(document).ready( function() {
			$('.direct-upload').fileupload({
				url: $(this).attr('action'),
				datatype: 'xml',
				type: 'POST',
				formData: {
					key: $(this).children('input[name=key]').val(),
					AWSAccessKeyId: $(this).children('input[name=AWSAccessKeyId]').val(),
					acl: $(this).children('input[name=acl]').val(),
					success_action_redirect: $(this).children('input[name=success_action_redirect]').val(),
					policy: $(this).children('input[name=policy]').val(),
					signature: $(this).children('input[name=signature]').val(),
					Content-Type: $(this).children('input[name=Content-Type]').val()
				},
				add: function (event, data) {
				  

					data.submit();
				},
				send: function(e, data) {
				  // show a loading spinner because now the form will be submitted to amazon, 
				  // and the file will be directly uploaded there, via an iframe in the background. 
				  console.log('send');
				  $('.progress').fadeIn();
				},
				fail: function(e, data) {
				  console.log('fail');
				  console.log(data);
				},
				progress: function(e, data){
					console.log('progress');
					// This is what makes everything really cool, thanks to that callback
					// you can now update the progress bar based on the upload progress
					var percent = Math.round((data.loaded / data.total) * 100);
					$('.bar').css('width', percent + '%');
				  },
				success: function(data) {
					console.log('success');
				},
				done: function (event, data) {
				  console.log('done');
				},
			});
		});
	</script>
	
	<script type='text/javascript'>

		var jmenus = {{ json_menus|safe }};
		var menus = new Array();
		var a = 0;
		for (var i=0; i<jmenus.length; i++){
			menus[i] = eval("(" + jmenus[i] + ')');
		};

	</script>
</html>